<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>JupLite Pro — Ultra Terminal</title>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="description" content="JupLite Pro — Ultra powered trading interface on Solana.">

<link rel="icon" href="/favicon-32.png" />

<style>
  :root {
    --bg: #020617;
    --text-main: #e5e7eb;
    --text-muted: #9ca3af;
    --radius-lg: 18px;
    --radius-full: 999px;
    --shadow-soft: 0 24px 60px rgba(15,23,42,0.9);
  }

  body {
    margin: 0;
    padding: 0;
    background: radial-gradient(circle at top, #0f172a 0, #020617 45%, #000 100%);
    font-family: system-ui, sans-serif;
    color: var(--text-main);
  }

  .shell {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  .topbar {
    position: sticky;
    top: 0;
    z-index: 20;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 18px;
    backdrop-filter: blur(16px);
    background: linear-gradient(to bottom, rgba(15,23,42,0.96), rgba(15,23,42,0.75), transparent);
    border-bottom: 1px solid rgba(30,64,175,0.9);
  }

  .brand {
    display: flex;
    align-items: center;
    gap: 10px;
    text-decoration: none;
    color: inherit;
  }

  .brand-logo-wrap {
    position: relative;
    width: 32px;
    height: 32px;
  }

  .brand-logo-img {
    width: 32px;
    height: 32px;
    border-radius: 40%;
    position: relative;
    z-index: 2;
  }

  .brand-logo-glow {
    position: absolute;
    inset: -12px;
    background: radial-gradient(circle at center, rgba(56,189,248,0.55), transparent 65%);
    opacity: 0.85;
    filter: blur(6px);
  }

  .brand-title {
    font-size: 18px;
    font-weight: 600;
  }

  .brand-sub {
    font-size: 11px;
    color: var(--text-muted);
  }

  .nav-right {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .nav-chip {
    padding: 6px 11px;
    border-radius: var(--radius-full);
    border: 1px solid rgba(148,163,184,0.6);
    color: var(--text-muted);
    background: rgba(15,23,42,0.9);
    display: inline-flex;
    align-items: center;
    gap: 6px;
    text-decoration: none;
    font-size: 12px;
  }

  .nav-chip:hover {
    filter: brightness(1.1);
  }

  .nav-chip-active {
    border-color: rgba(56,189,248,0.9);
    background: rgba(56,189,248,0.15);
    color: #e0f2fe;
  }

  /* ULTRA PANEL */
  .terminal-wrapper {
    flex: 1;
    padding: 18px;
    max-width: 1200px;
    margin: 0 auto 24px;
  }

  .terminal-wrapper iframe {
    width: 100%;
    border-radius: var(--radius-lg);
    border: 1px solid rgba(31,41,55,0.95);
    background: radial-gradient(circle at top, rgba(15,23,42,0.98), #020617);
    box-shadow: var(--shadow-soft);
    padding: 12px;
    min-height: 600px;
  }

  iframe {
    width: 100%;
    height: 720px;
    border: none;
    border-radius: 18px;
    overflow: hidden;
  }

  @media (max-width: 800px) {
    iframe { height: 900px; }
  }

  @media (max-width: 480px) {
    iframe { height: 1100px; }
  }

  /* === Watchlist in Pro header === */

  .nav-chip-secondary {
    border-color: rgba(148,163,184,0.7);
    background: rgba(15,23,42,0.96);
    color: var(--text-main);
    cursor: pointer;
  }

  .nav-chip-secondary:hover {
    filter: brightness(1.1);
    border-color: rgba(56,189,248,0.85);
  }

  .watchlist-panel {
    position: fixed;
    top: 76px;
    right: 16px;
    width: 320px;
    max-height: 420px;
    background:
      radial-gradient(circle at top, rgba(15,23,42,0.98), #020617);
    border-radius: var(--radius-lg);
    border: 1px solid rgba(31,41,55,0.95);
    box-shadow: var(--shadow-soft);
    padding: 12px;
    display: flex;
    flex-direction: column;
    z-index: 9999;
  }

  .watchlist-panel.hidden {
    display: none;
  }

  .watchlist-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 8px;
  }

  .watchlist-title {
    font-size: 14px;
    font-weight: 600;
  }

  .watchlist-close-btn {
    border: none;
    background: transparent;
    color: var(--text-muted);
    cursor: pointer;
    font-size: 14px;
  }

  .watchlist-close-btn:hover {
    color: var(--text-main);
  }

  .watchlist-add-row {
    display: flex;
    gap: 8px;
    margin-bottom: 8px;
  }

  #watchlist-input {
    flex: 1;
    padding: 6px 8px;
    border-radius: var(--radius-full);
    border: 1px solid rgba(148,163,184,0.4);
    background: #020617;
    color: var(--text-main);
    font-size: 12px;
  }

  #watchlist-input::placeholder {
    color: var(--text-muted);
  }

  #watchlist-input:focus {
    outline: none;
    border-color: rgba(56,189,248,0.9);
  }

  #watchlist-add-btn {
    padding: 6px 10px;
    border-radius: var(--radius-full);
    border: none;
    background: rgba(56,189,248,0.95);
    color: #020617;
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
  }

  #watchlist-add-btn:hover {
    filter: brightness(1.05);
  }

  .watchlist-table-wrapper {
    flex: 1;
    overflow: auto;
  }

  .watchlist-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
  }

  .watchlist-table th,
  .watchlist-table td {
    padding: 4px 2px;
    text-align: left;
  }

  .watchlist-table thead {
    color: var(--text-muted);
    border-bottom: 1px solid rgba(31,41,55,0.9);
  }

  .watchlist-token-symbol {
    font-weight: 500;
  }

  .watchlist-price {
    font-variant-numeric: tabular-nums;
  }

  .watchlist-remove-btn {
    border: none;
    background: transparent;
    cursor: pointer;
    color: var(--text-muted);
    font-size: 12px;
  }

  .watchlist-remove-btn:hover {
    color: #f97373;
  }

  .watchlist-footer {
    margin-top: 6px;
    text-align: right;
    color: var(--text-muted);
    font-size: 10px;
  }

  @media (max-width: 640px) {
    .watchlist-panel {
      right: 8px;
      left: 8px;
      width: auto;
    }
  }
</style>
</head>
<body>

<div class="shell">

  <header class="topbar">
    <a href="/index.html" class="brand">
      <div class="brand-logo-wrap">
        <div class="brand-logo-glow"></div>
        <img src="/icon-192.png" class="brand-logo-img" alt="logo" />
      </div>

      <div>
        <div class="brand-title">JupLite</div>
        <div class="brand-sub">Pro · Ultra Trading Interface</div>
      </div>
    </a>

    <nav class="nav-right">
      <a href="/index.html" class="nav-chip">Home</a>
      <a href="/swap.html" class="nav-chip">Swap</a>
      <span class="nav-chip nav-chip-active">Ultra</span>
      <button id="watchlist-toggle-btn" class="nav-chip nav-chip-secondary">★ Watchlist</button>
    </nav>
  </header>

  <main class="terminal-wrapper">
    <!-- ВСТРАИВАЕМ ТВОЙ ULTRA UI -->
    <iframe src="/ultra.html"></iframe>
  </main>

</div>

<!-- Watchlist panel (общая для Pro-страниц) -->
<div id="watchlist-panel" class="watchlist-panel hidden">
  <div class="watchlist-header">
    <span class="watchlist-title">Watchlist</span>
    <button id="watchlist-close-btn" class="watchlist-close-btn">✕</button>
  </div>

  <div class="watchlist-add-row">
    <input
      id="watchlist-input"
      type="text"
      placeholder="Add token symbol or mint (e.g. SOL, JUP)"
    />
    <button id="watchlist-add-btn">Add</button>
  </div>

  <div class="watchlist-table-wrapper">
    <table class="watchlist-table">
      <thead>
        <tr>
          <th>Token</th>
          <th>Price (USD)</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="watchlist-body">
        <!-- rows by JS -->
      </tbody>
    </table>
  </div>

  <div class="watchlist-footer">
    <small>Prices via price.jup.ag · auto-refresh every 10s</small>
  </div>
</div>

<script>
  (function () {
    const STORAGE_KEY = "jupLiteWatchlistTokens";
    const DEFAULT_TOKENS = ["SOL", "USDC", "JUP", "BONK"];

    let watchlist = [];
    let prices = {};
    let refreshInterval = null;
    let isFetching = false;

    const panel = document.getElementById("watchlist-panel");
    const toggleBtn = document.getElementById("watchlist-toggle-btn");
    const closeBtn = document.getElementById("watchlist-close-btn");
    const bodyEl = document.getElementById("watchlist-body");
    const inputEl = document.getElementById("watchlist-input");
    const addBtn = document.getElementById("watchlist-add-btn");

    function loadWatchlist() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) {
          const parsed = JSON.parse(raw);
          if (Array.isArray(parsed)) {
            watchlist = parsed;
            return;
          }
        }
      } catch (e) {
        console.warn("Failed to parse watchlist from storage", e);
      }
      watchlist = DEFAULT_TOKENS.slice();
    }

    function saveWatchlist() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(watchlist));
      } catch (e) {
        console.warn("Failed to save watchlist", e);
      }
    }

    function renderWatchlist() {
      if (!bodyEl) return;
      bodyEl.innerHTML = "";

      if (!watchlist.length) {
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 3;
        td.textContent = "Watchlist is empty. Add tokens above.";
        td.style.color = "#9ca3af";
        bodyEl.appendChild(tr);
        tr.appendChild(td);
        return;
      }

      watchlist.forEach((token) => {
        const tr = document.createElement("tr");

        const tdSymbol = document.createElement("td");
        tdSymbol.textContent = token;
        tdSymbol.className = "watchlist-token-symbol";

        const tdPrice = document.createElement("td");
        tdPrice.className = "watchlist-price";
        const priceObj = prices[token];
        if (priceObj && typeof priceObj.price === "number") {
          tdPrice.textContent = "$" + priceObj.price.toFixed(4);
        } else {
          tdPrice.textContent = "...";
        }

        const tdRemove = document.createElement("td");
        const removeBtn = document.createElement("button");
        removeBtn.className = "watchlist-remove-btn";
        removeBtn.textContent = "✕";
        removeBtn.addEventListener("click", () => {
          removeToken(token);
        });
        tdRemove.appendChild(removeBtn);

        tr.appendChild(tdSymbol);
        tr.appendChild(tdPrice);
        tr.appendChild(tdRemove);
        bodyEl.appendChild(tr);
      });
    }

    async function fetchPrices() {
      if (isFetching) return;
      if (!watchlist.length) {
        prices = {};
        renderWatchlist();
        return;
      }

      isFetching = true;
      try {
        const ids = encodeURIComponent(watchlist.join(","));
        const url = `https://price.jup.ag/v6/price?ids=${ids}`;
        const res = await fetch(url, { method: "GET" });

        if (!res.ok) {
          console.warn("Price API non-OK", res.status);
          isFetching = false;
          return;
        }

        const data = await res.json();
        if (data && data.data) {
          prices = data.data;
          renderWatchlist();
        }
      } catch (e) {
        console.warn("Error fetching prices", e);
      } finally {
        isFetching = false;
      }
    }

    function ensureInterval() {
      if (refreshInterval) return;
      fetchPrices();
      refreshInterval = setInterval(fetchPrices, 10000);
    }

    function openPanel() {
      if (!panel) return;
      panel.classList.remove("hidden");
      ensureInterval();
    }

    function closePanel() {
      if (!panel) return;
      panel.classList.add("hidden");
    }

    function togglePanel() {
      if (!panel) return;
      if (panel.classList.contains("hidden")) {
        openPanel();
      } else {
        closePanel();
      }
    }

    function normalizeToken(str) {
      return (str || "").trim().toUpperCase();
    }

    function addTokenFromInput() {
      const val = normalizeToken(inputEl && inputEl.value);
      if (!val) return;
      if (!watchlist.includes(val)) {
        watchlist.push(val);
        saveWatchlist();
        renderWatchlist();
        fetchPrices();
      }
      if (inputEl) inputEl.value = "";
    }

    function removeToken(token) {
      watchlist = watchlist.filter((t) => t !== token);
      saveWatchlist();
      renderWatchlist();
      fetchPrices();
    }

    if (panel && toggleBtn && closeBtn && bodyEl && inputEl && addBtn) {
      loadWatchlist();
      renderWatchlist();

      toggleBtn.addEventListener("click", togglePanel);
      closeBtn.addEventListener("click", closePanel);
      addBtn.addEventListener("click", addTokenFromInput);
      inputEl.addEventListener("keydown", (e) => {
        if (e.key === "Enter") addTokenFromInput();
      });

      window.addEventListener("beforeunload", () => {
        if (refreshInterval) {
          clearInterval(refreshInterval);
        }
      });
    } else {
      console.warn("Watchlist elements not found on this page (ok for non-Pro pages)");
    }
  })();
</script>

</body>
</html>
